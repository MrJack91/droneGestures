\chapter{Konzept}

\section{Detaillierter Gesten-Steuerbeschrieb}

Ziel dieser Steuerung ist es, die Drohne sehr einfach steuern zu können.
Das auswendig Lernen der möglichen Gesten soll durch intuitive Schlussfolgerungen des Anwendungswunsches entfallen.
Der Grundgedanke der Steuerung soll die Hand sein, welche die Drohne verkörpert.

\begin{framed}
\textit{Definition: }\textbf{Position}\\
Im Folgenden ist mit dem Begriff \textit{Position} jeweils die dreidimensionale Ausrichtung im Raum und nicht der effektive Standort gemeint.
\end{framed}

\subsection{Leap Motion}
%todo correct
Es folgt eine grobe Übersicht des Gestenerkennungs-Sensores \textit{Leap Motion}.
Detailliertere Informationen finden Sie im \secref{subsec:leapmotion}.
% Es folgen grobe Informationen zum Gestenerkennungs-Sensor \textit{Leap Motion}.

Der Sensor erkennt Gesten innerhalb eines 150\textdegree-Winkels zwischen 25\,mm und 600\,mm Höhe.
Sprich auf ca. 30\,cm Höhe funktioniert die Erkennung bestens und wir haben genügend vertikale Spatzung um Höhenunterschiede festzustellen.
Folgend wird auf die grundlegenden Flugmanöver eingegangen.


\subsection{Flugmanöver}

\subsubsection{Init}

Da die Hand die Drohne repräsentieren soll, muss eine initiale Position eingenommen werden, aus dieser die Drohne anschliessend (relativ gemessen) gesteuert werden kann.

Dieser Prozess vom Finden der initialen Position wird folgend als \textit{Init-Prozess} bezeichnet und sieht wie folgt aus:

\begin{itemize}
	\item Die Drohne befindet sich im \textit{Init-Zustand (Z1)}.
	\item Die Hand wird auf idealer Höhe platziert (ca. 10 -- 20\,cm über dem Sensor).
	\item Die Position gilt als eingenommen, sobald nach einer Faust wiederum die offene Hand erkannt wird. (Faust-Gesten in nicht idealen Höhen werden ignoriert.)
	\item Die Drohne befindet sich nun im \textit{flugbereiten Zustand (Z2)} (die Rotoren drehen nicht).
	\item Die Hand bleibt geöffnet (erneute Erkennung einer Faust-Geste löst einen Zustandswechsel vom \textit{flugbereiten Zustand (Z2)} zurück in den \textit{Init-Zustand (Z1)}) aus.
\end{itemize}

\subsubsection{Start / Thrust (Höhe)}
Um mit der Drohne abzuheben wird die offene Hand nach oben bewegt. Dabei gilt, umso höher die Hand zur relativen Position gehoben wird, desto mehr drehen die Rotoren und umso schneller bewegt sich die Drohne nach oben (dies entspricht dem \textit{Thrust}).

Umgekehrtes gilt auch: wird die Hand gesenkt, senkt sich auch die Drehzahl der Rotoren, sprich die Drohne verliert an Steigung.
Der \textit{Thrust} kann während des ganzen Fluges mit diesen Bewegungen gesteuert werden.
Die Drohne befindet sich, sobald sie abgehoben ist, im \textit{Flug-Zustand (Z3)} (mit drehenden Rotoren in der Luft).

\subsubsection{Flug}
Während dem Flug kann nebst dem \textit{Thrust}, die Drehung (\textit{Yaw}) und die Neigung (\textit{Pitch/Roll}) gesteuert werden.
Auch hier gilt jeweils, dass die Drohne sich nach der Hand ausrichtet.
Die Drohne ist solange im \textit{Flug-Zustand (Z3)} bis sie wieder auf festem Untergrund ist, dann ist sie wieder im \textit{flugbereiten Zustand (Z2)}.
Bezüglich der Steuermöglichkeiten ändert sich weder im \textit{Flug- (Z3)} noch im \textit{flugbereiten Zustand (Z2)} etwas.
Sprich es ist kein Zustandswechsel nötig, um die Drohne zu landen.

\textbf{Bemerkung zur Steuerung:} Grundsätzlich wird der Level (Power) einer Steueranweisung, gemäss der Abweichung der natürlichen, rechtwinkligen, vertikalen Achsen gesetzt, wobei eine ca. 60\textdegree-Abweichung dem Maximum entspricht.\\
Eine mögliche Optimierung ist, dass die Drohne-Position immer exakt der Hand-Position angepasst wird.
Dazu muss die Steuerung die Position der Drohne mit der Hand-Position vergleichen und falls nötig die Position der Drohne korrigieren.
Der Unterschied zur Basis-Steuerung besteht darin, dass sich das Fliegen noch intuitiver anfühlt, da die Drohne sich wirklich an der Hand orientiert und nicht nur wie mit einer klassischen Fernsteuerung ein Steuerkommando erhält und ausführt.
%todo remove remark
Ob dies so umzusetzen ist bleibt abzuklären und ist stark abhängig von der API der Drohne.

\subsubsection{Yaw (Drehung / Gieren)}
\begin{wrapfigure}{r}{0.4\textwidth}
	\includegraphics[width=1.0\linewidth]{images/concept/yaw_pitch_roll.png}
	\caption[Steuermanöver]{Mögliche Steuermanöver einer Drohne (Quelle: \fullcite{IaTsI_2015-03-25})}
\end{wrapfigure}
Analog zum Thrust bedeutet eine flache Drehung der Hand (Drehung an der vertikalen Rotations-Achse) eine entsprechende Richtungsänderung der Drohne.

\subsubsection{Pitch (Neigung) / Roll (Rolle)}
Beim Pitch und Roll dreht sich die Drohne um eine horizontale Rotations-Achse. Beim Pitch hebt oder neigt die Drohne ihre Front. Bei Roll sinkt oder erhebt sich eine Seite.

\subsubsection{Finish}
Befindet sich die Drohne im \textit{flugbereiten Zustand (Z2)}, kann via eine Faust-Geste, die Steuerung abgebrochen werden.
Die Drohne reagiert bis zum nächsten \textit{Init-Prozess} nicht mehr.

\subsection{Zustands Übersicht}
Die Drohne kann aus Sicht der Steuerung, insofern sie eingeschaltet ist, vier Zustände einnehmen:

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\textwidth]{figures/concept/state-diagram.pdf}
	\caption[Zustand-Diagramm: Drohne mit Gestensteuerung]{Zustand-Diagramm: Drohne mit Gestensteuerung}
\end{figure}

\subsubsection{Off-Zustand (Z0)}
Die Drohne ist ausgeschaltet.

\subsubsection{Init-Zustand (Z1)}
Die Drohne kann nicht geflogen werden, sondern eine Hand muss zuerst in der initialen Position erkannt werden.

\subsubsection{Flugbereiten Zustand (Z2)}
Die Drohne fliegt nicht, hat aber eine korrekt initialisierte Hand für die Steuerung registriert. Dies kann nach und vor einem Flug sein.

\subsubsection{Flug-Zustand (Z3)}
Die Drohne befindet sich in der Luft.

\subsubsection{Unkontrollierten Zustand (Z4)}
%todo correct
Die Hand wird während dem Flug nicht mehr erkannt.
Wenn keine Hand innerhalb einer bestimmten Zeit erfasst wird, wird die Drohne Not gelandet (stürzt sie ab).

%%%

%todo
\section{Problembehandlung}
Während den verschiedenen Zustände können verschiedene Fehler auftreten:

\subsubsection{Init-Zustand (Z1)}

\begin{table}[H]
	\centering
	\small\renewcommand{\arraystretch}{1.4}
	\rowcolors{1}{tablerowcolor}{tablebodycolor}
	%
	\captionabove{Problem: \textit{Init-Zustand (Z1)} -- Hand-Erkennung}
	%
	\begin{tabularx}{0.9\textwidth}{ L{0.121\linewidth} | X  }%
		\hline
		Problem: & Faust wird nicht erkannt oder mehrere Hände werden erkannt.\\
		Risiko: & \textit{gering}\\
		Folge: & Die Drohne kann nicht abheben. Der \textit{Init-Zustand (Z1)} wird belassen.\\
		\hline
	\end{tabularx}
\end{table}



\subsubsection{Flugbereiten Zustand (Z2)}

\begin{table}[H]
	\centering
	\small\renewcommand{\arraystretch}{1.4}
	\rowcolors{1}{tablerowcolor}{tablebodycolor}
	%
	\captionabove{Problem: \textit{Flugbereiten Zustand (Z2)} -- Hand-Erkennung}
	%
	\begin{tabularx}{0.9\textwidth}{ L{0.121\linewidth} | X  }%
		\hline
		Problem: & Die Hand wird nicht mehr erkannt.\\
		Risiko: & \textit{gering}\\
		Folge: & Die Drone setzt sich zurück in den \textit{Init-Zustand (Z1)}. (Die Drohne befindet sich noch auf dem Boden.)\\
		\hline
	\end{tabularx}
\end{table}


\subsubsection{Flug-Zustand (Z3)}
\begin{table}[H]
	\centering
	\small\renewcommand{\arraystretch}{1.4}
	\rowcolors{1}{tablerowcolor}{tablebodycolor}
	%
	\captionabove{Problem: \textit{Flug-Zustand (Z3)} -- Hand-Erkennung}
	%
	\begin{tabularx}{0.9\textwidth}{ L{0.121\linewidth} | X  }%
		\hline
		Problem: & Die Hand wird nicht mehr erkannt oder mehrere Hände werden erkannt.\\
		Risiko: & \textit{sehr gross}\\
		Verhalten: & Der Thrust wird sofort auf mässiges Level getrimmt. Falls länger als $t$ Sekunden keine Hand erkannt wird, werden die Rotoren ausgeschaltet. Die Drohne wechselt in den Init-Zustand  (Z1).\\
		Folge: & Die Drohne befindet sich ungesteuert in der Luft oder wird notgelandet (resp. stürzt ab).\\
		\hline
	\end{tabularx}
\end{table}


\begin{table}[H]
	\centering
	\small\renewcommand{\arraystretch}{1.4}
	\rowcolors{1}{tablerowcolor}{tablebodycolor}
	%
	\captionabove{Problem: \textit{Flug-Zustand (Z3)} -- Ruckartige Bewegungen}
	%
	\begin{tabularx}{0.9\textwidth}{ L{0.121\linewidth} | X  }%
		\hline
		Problem: & Starke, unkontrollierte und ruckartige Steuerschwankungen (z.B. aus Angst-Reaktionen etc.).\\
		Risiko: & \textit{erheblich}\\
		Verhalten: & Die Steuerung reguliert, resp. vermeidet sprunghafte Steuerbefehle.\\
		Folge: & Kunstflüge mit bewussten schnellen Anweisungen sind nicht möglich.\\
		\hline
	\end{tabularx}
\end{table}
%

\section{Tests}


%%%
